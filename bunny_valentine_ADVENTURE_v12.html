<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Bunny Valentine Adventure</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  background: #ffd6e8;
  overflow: hidden;
  touch-action: none;
  font-family: Arial, sans-serif;
}
canvas { display:block; }
#controls {
  position: fixed;
  bottom: 12px;
  width: 100%;
  display: flex;
  justify-content: space-around;
  z-index: 10;
}
.btn {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  background: rgba(255,105,180,0.9);
  color: white;
  font-size: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
}
#overlay {
  position: fixed;
  inset: 0;
  background: rgba(255,214,232,0.96);
  display: none;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  text-align: center;
  z-index: 20;
}
#overlay button {
  margin-top: 20px;
  padding: 14px 28px;
  font-size: 20px;
  border-radius: 30px;
  border: none;
  background: #ff69b4;
  color: white;
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="overlay">
  <h1 id="overlayTitle"></h1>
  <p id="overlayText"></p>
  <button id="overlayBtn">Tap to Start</button>
</div>

<div id="controls">
  <div class="btn" id="btnLeft">‚¨ÖÔ∏è</div>
  <div class="btn" id="btnJump">‚¨ÜÔ∏è</div>
  <div class="btn" id="btnShoot">ü•ï</div>
  <div class="btn" id="btnRight">‚û°Ô∏è</div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
function resize(){canvas.width=innerWidth;canvas.height=innerHeight;}
resize(); addEventListener("resize",resize);

/* MUSIC + SFX */
const music = new Audio("https://cdn.pixabay.com/audio/2022/10/30/audio_6c1b6d9d1d.mp3");
music.loop = true; music.volume = 0.45;

const jumpSfx = new Audio("https://cdn.pixabay.com/audio/2022/03/15/audio_1f8d7c9f3a.mp3");
const shootSfx = new Audio("https://cdn.pixabay.com/audio/2022/03/10/audio_5f6a8d1b1a.mp3");
const winSfx = new Audio("https://cdn.pixabay.com/audio/2022/03/15/audio_2e1a9c9c72.mp3");

jumpSfx.volume = 0.6;
shootSfx.volume = 0.6;
winSfx.volume = 0.7;

/* STATE */
let state="intro";
let keys={}, gravity=0.7, cameraX=0, hasKey=false;

/* PLATFORM */
const groundY=canvas.height-130;
const levelLength=1700;
let bunny={x:120,y:groundY-40,w:32,h:32,vy:0,onGround:false,jumps:0,maxJumps:2};

const holes=[{x:450,w:90},{x:800,w:90},{x:1150,w:90}];
const platforms=[{x:600,y:groundY-120},{x:950,y:groundY-180},{x:1300,y:groundY-140}];
const keyItem={x:900,y:groundY-220,collected:false};
const ship={x:levelLength-120,y:groundY-60};

/* SHOOTER */
let stars=[], planets=[], asteroids=[], bullets=[], score=0;
const bunnyShip={x:canvas.width/2,y:canvas.height-120,r:22,speed:6};

for(let i=0;i<140;i++) stars.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,s:Math.random()*2+1});

/* ONLY 3 PLANETS */
for(let i=0;i<3;i++){
  planets.push({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height*0.6,
    r:55+Math.random()*20,
    speed:0.15,
    hue:Math.random()*360,
    ring:i===0,      // only ONE has rings
    stripes:i!==2   // two have stripes
  });
}

function spawnAsteroid(){ if(state==="shooter") asteroids.push({x:Math.random()*canvas.width,y:-40,speed:2+Math.random()*2}); }
setInterval(spawnAsteroid,800);

/* OVERLAY */
const overlay=document.getElementById("overlay");
const overlayTitle=document.getElementById("overlayTitle");
const overlayText=document.getElementById("overlayText");
const overlayBtn=document.getElementById("overlayBtn");

function showOverlay(t,txt,cb){
  overlay.style.display="flex";
  overlayTitle.innerText=t;
  overlayText.innerText=txt;
  overlayBtn.onclick=()=>{overlay.style.display="none";cb();};
}

showOverlay("üê∞ Bunny Valentine Adventure üíñ","Press start and collect the üîë to reach the spaceship üöÄ",()=>state="run");

/* ACTIONS */
function jump(){
  if(bunny.jumps<bunny.maxJumps){
    bunny.vy = bunny.jumps===0 ? -14 : -12;
    bunny.jumps++;
    jumpSfx.currentTime=0;
    jumpSfx.play();
  }
}
function shoot(){
  if(state==="shooter"){
    bullets.push({x:bunnyShip.x,y:bunnyShip.y-30});
    shootSfx.currentTime=0;
    shootSfx.play();
  }
}

/* UPDATE */
function update(){
  if(state==="run"){
    if(keys.left) bunny.x-=4;
    if(keys.right) bunny.x+=4;
    bunny.vy+=gravity; bunny.y+=bunny.vy; bunny.onGround=false;

    if(bunny.y+bunny.h>=groundY){
      bunny.y=groundY-bunny.h;
      bunny.vy=0;
      bunny.onGround=true;
      bunny.jumps=0;
    }

    platforms.forEach(p=>{
      if(bunny.x+bunny.w>p.x && bunny.x<p.x+80 &&
         bunny.y+bunny.h>=p.y && bunny.y+bunny.h<=p.y+10){
        bunny.y=p.y-bunny.h;
        bunny.vy=0;
        bunny.onGround=true;
        bunny.jumps=0;
      }
    });

    holes.forEach(h=>{
      if(bunny.x+bunny.w>h.x && bunny.x<h.x+h.w && bunny.y+bunny.h>=groundY){
        bunny.y=canvas.height+200;
      }
    });

    if(!keyItem.collected &&
       bunny.x+bunny.w>keyItem.x && bunny.x<keyItem.x+20 &&
       bunny.y+bunny.h>keyItem.y){
      keyItem.collected=true;
      hasKey=true;
    }

    if(bunny.y>canvas.height){
      bunny.x=120; bunny.y=groundY-bunny.h; bunny.jumps=0;
    }

    cameraX=bunny.x-canvas.width/2.5;
    cameraX=Math.max(0,Math.min(levelLength-canvas.width,cameraX));

    if(bunny.x>ship.x && hasKey){
      document.getElementById("btnJump").style.display="none";
      showOverlay(
        "üöÄ Defend the Galaxy!",
        "Defend the galaxy in the name of bunny love! üíñ\nTap anywhere to start",
        ()=>{state="shooter"; music.play();}
      );
      state="ready";
    }
  }

  if(state==="shooter"){
    if(keys.left) bunnyShip.x-=bunnyShip.speed;
    if(keys.right) bunnyShip.x+=bunnyShip.speed;
    bunnyShip.x=Math.max(bunnyShip.r,Math.min(canvas.width-bunnyShip.r,bunnyShip.x));

    stars.forEach(s=>{s.y+=s.s;if(s.y>canvas.height)s.y=0;});
    planets.forEach(p=>{p.y+=p.speed;if(p.y-p.r>canvas.height){p.y=-p.r;p.x=Math.random()*canvas.width;}});

    bullets.forEach(b=>b.y-=10);
    bullets=bullets.filter(b=>b.y>-20);
    asteroids.forEach(a=>a.y+=a.speed);
    asteroids=asteroids.filter(a=>a.y<canvas.height+60);

    asteroids.forEach((a,ai)=>{
      bullets.forEach((b,bi)=>{
        if(Math.hypot(a.x-b.x,a.y-b.y)<30){
          asteroids.splice(ai,1);
          bullets.splice(bi,1);
          score++;
          if(score>=10){
            state="win";
            music.pause();
            winSfx.play();
          }
        }
      });
    });
  }
}

function drawPlanet(p){
  const g=ctx.createRadialGradient(p.x-p.r/3,p.y-p.r/3,10,p.x,p.y,p.r);
  g.addColorStop(0,`hsla(${p.hue},70%,70%,1)`);
  g.addColorStop(1,`hsla(${p.hue},70%,30%,1)`);
  ctx.fillStyle=g;
  ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();

  if(p.stripes){
    ctx.strokeStyle=`hsla(${p.hue},80%,80%,0.35)`;
    for(let i=-p.r;i<p.r;i+=12){
      ctx.beginPath();
      ctx.arc(p.x,p.y+i/3,p.r-6,0,Math.PI);
      ctx.stroke();
    }
  }

  if(p.ring){
    ctx.strokeStyle="rgba(255,255,255,0.55)";
    ctx.lineWidth=4;
    ctx.beginPath();
    ctx.ellipse(p.x,p.y,p.r+18,p.r/2,0,0,Math.PI*2);
    ctx.stroke();
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(state==="run"){
    ctx.save(); ctx.translate(-cameraX,0);
    ctx.fillStyle="#ffd6e8"; ctx.fillRect(cameraX,0,canvas.width,canvas.height);
    ctx.fillStyle="white";
    for(let i=0;i<10;i++){
      let cx=i*320+120;
      ctx.beginPath();
      ctx.arc(cx,120,32,0,Math.PI*2);
      ctx.arc(cx+34,120,38,0,Math.PI*2);
      ctx.arc(cx+70,120,32,0,Math.PI*2);
      ctx.fill();
    }

    ctx.fillStyle="#ffb6c1";
    ctx.fillRect(0,groundY,levelLength,canvas.height-groundY);
    holes.forEach(h=>ctx.clearRect(h.x,groundY,h.w,canvas.height-groundY));
    platforms.forEach(p=>{ctx.fillStyle="#ff8fab";ctx.fillRect(p.x,p.y,80,12);});

    if(!keyItem.collected){ctx.font="24px Arial";ctx.fillText("üîë",keyItem.x,keyItem.y+24);}

    ctx.fillStyle="white";
    ctx.fillRect(bunny.x,bunny.y,bunny.w,bunny.h);
    ctx.fillRect(bunny.x,bunny.y-26,10,26);
    ctx.fillRect(bunny.x+22,bunny.y-26,10,26);

    ctx.fillStyle="#ff69b4";
    ctx.fillRect(ship.x,ship.y,60,40);
    ctx.font="24px Arial";
    ctx.fillText(hasKey ? "üöÄ" : "üîí",ship.x+18,ship.y+30);

    ctx.restore();
  }

  if(state==="shooter"){
    ctx.fillStyle="rgba(5,10,25,0.35)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle="white";
    stars.forEach(s=>ctx.fillRect(s.x,s.y,s.s,s.s));

    planets.forEach(p=>drawPlanet(p));

    ctx.fillStyle="white";
    ctx.beginPath(); ctx.arc(bunnyShip.x,bunnyShip.y,bunnyShip.r,0,Math.PI*2); ctx.fill();
    ctx.fillRect(bunnyShip.x-14,bunnyShip.y-45,10,28);
    ctx.fillRect(bunnyShip.x+4,bunnyShip.y-45,10,28);
    ctx.fillStyle="pink";
    ctx.fillRect(bunnyShip.x-14,bunnyShip.y+18,28,12);

    bullets.forEach(b=>{ctx.fillStyle="orange";ctx.fillRect(b.x-3,b.y,6,18);});

    asteroids.forEach(a=>{
      ctx.fillStyle="#ff8c42";
      ctx.beginPath(); ctx.ellipse(a.x,a.y,8,30,Math.PI/4,0,Math.PI*2); ctx.fill();
      ctx.fillStyle="#4caf50";
      ctx.fillRect(a.x-2,a.y-40,4,14);
    });

    ctx.fillStyle="white";
    ctx.fillText(`Carrots: ${score}/10`,20,30);
  }

  if(state==="win"){
    ctx.fillStyle="rgba(255,182,193,0.95)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle="#ff1493";
    ctx.textAlign="center";
    ctx.font="bold 26px Arial";
    ["üéâ Congratulations üéâ","You won $100 from Mayke üíµ","Happy Valentine's Day bunny üíñ","I love you üê∞"]
      .forEach((t,i)=>ctx.fillText(t,canvas.width/2,canvas.height/2-60+i*40));
  }
}

function loop(){update();draw();requestAnimationFrame(loop);}
loop();

/* INPUT */
addEventListener("keydown",e=>{
  if(e.code==="ArrowLeft") keys.left=true;
  if(e.code==="ArrowRight") keys.right=true;
  if(e.code==="Space"){
    if(state==="run") jump();
    else if(state==="shooter") shoot();
  }
});
addEventListener("keyup",e=>{
  if(e.code==="ArrowLeft") keys.left=false;
  if(e.code==="ArrowRight") keys.right=false;
});

btnLeft.ontouchstart=()=>keys.left=true;
btnLeft.ontouchend=()=>keys.left=false;
btnRight.ontouchstart=()=>keys.right=true;
btnRight.ontouchend=()=>keys.right=false;
btnJump.ontouchstart=()=>jump();
btnShoot.ontouchstart=()=>shoot();
</script>
</body>
</html>
